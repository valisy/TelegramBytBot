# Telegram-бот для учёта домашних расходников.

Телеграм-бот на Python для отслеживания сроков начала использования бытовых расходных материалов (мыло, жидкость для мытья посуды).

---

## Технологический стек

- **Язык**: Python 3.9+ (конкретная реализация была на 3.13.3)
- **Фреймворк**: `aiogram 3.x` — асинхронная библиотека для работы с Telegram Bot API
- **Хранилище данных**: `sqlite3` — встроенная СУБД, не требует внешних зависимостей
- **Управление состоянием**: FSM (Finite State Machine) из `aiogram` для многошаговых сценариев
- **Управление секретами**: `python-dotenv` — загрузка токена из файла `.env`
- **Архитектура**: polling-режим, изоляция данных по `user_id`, отсутствие глобального shared state

---

## Функционал

Бот поддерживает следующие команды:

- `/start` — приветствие и краткая справка по командам  
- `/add` — добавление нового расходника:
  1. Ввод названия (до 100 символов, проверка на пустоту)
  2. Ввод даты начала использования в формате `ДД.ММ.ГГГГ` (валидация формата и логики: дата не в будущем)
- `/list` — вывод всех расходников текущего пользователя, отсортированных по дате начала с количеством дней использования
- `/remove <название>` — удаление расходника по точному совпадению названия; при отсутствии совпадения — уведомление

Все данные хранятся локально и изолированы по `user_id`. Перезапуск бота не приводит к потере данных.

---

## Меры информационной безопасности

- **Конфиденциальность токена**: токен бота загружается из `.env`, исключён из контроля версий (через `.gitignore`)
- **Защита от SQL-инъекций**: все запросы к БД — параметризованные (`?` вместо подстановки значений в строку)
- **Валидация входных данных**:
  - длина и непустота названия
  - строгий парсинг даты с проверкой логического ограничения (не позже текущей даты)
- **Очистка состояния**: вызов `state.clear()` после завершения сценария `/add`
- **Минимизация attack surface**:
  - polling вместо веб-хуков
  - отсутствие внешних HTTP-вызовов (кроме Telegram API)
  - отсутствие глобальных переменных с пользовательскими данными

---

## Быстрый старт (если захотите деплоить к себе)

1. Установите зависимости:
   ```bash
   pip install aiogram python-dotenv
2. Создайте файл .env в корне проекта: 

    TOKEN=123456789:ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnop
    
    (токен получите у @BotFather ) 

3. Запустите бота: 
    '''bash
    
    python main.py
     

4. В Telegram отправьте /start, затем /add, чтобы добавить первый расходник. 
     
При первом запуске автоматически создаётся файл consumables.db — локальная база данных. 

---

Структура проекта

.

├── main.py          # основной код бота

├── .env             # переменные окружения (не коммитится)

├── consumables.db   # SQLite-база (создаётся автоматически)

└── .gitignore       # должен содержать: .env, consumables.db, __pycache__/

---
Проект готов к использованию, легко поддерживается и соответствует современным практикам безопасной разработки.
